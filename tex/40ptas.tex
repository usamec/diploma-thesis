Zamerajme sa teraz na inštancie, kde vrcholy grafu reprezentujú body v rovine a hrany
vzdialenosti medzi nimi. V prípade obyčajného problému obchodného cestujúceho
existuje PTAS (polynomial time approximation scheme) (\cite{Arora}), t.j. algoritmus, ktorý
pre ľubovoľný aproximačný pomer beží v polynomiálnom čase od veľkosti vstupu.

My v nasledujúcej časti použijeme myšlienky z tohoto algoritmu a ukážeme ako spraviť PTAS pre
problém dvoch obchodných cestujúcich.

Hlavnou myšlienkou algoritmu pomocou techniky rozdeľuj a panuj vybudovať nad vstupom
randomizovaný quad-tree. Následne ukážeme, že pre $(1 + 1/c)$-aproximačný algoritmus stačí, aby
TSP-cesty pretínali hrany delenia iba $O(c)$ krát. Navyše tieto prieniky sa môžu
udiať iba v niektorých špeciálnych bodoch.

\section{Rekurzívne delenie}

%Rovinu v ktorej ležia vstupné body budeme rekurzívne deliť na menšie časti.
%Najprv rovinu rozdelíme vodorovnou a zvislou čiarou na štyri časti, každú z nich na ďalšie štyri, ...
%Takto by sme dostali tzv. quadtree. Na správnu fukčnosť algoritmu potrebujeme ale tzv.
%posunutý quadtree, kde deliace čiary neprechádzajú stredom, ale sú vyberané náhodne.
%

Pre začiatok predpokladajme, že všetky body majú celočíselné súradnice a vzdialenosť
medzi nimi je aspoň $8$. Neskôr ukážeme, že každý vstup vieme takto upraviť a ak budeme mať PTAS
pre upravený vstup, tak budeme mať PTAS aj pre pôvodný vstup.

Nech všetky body ležia vo vnútri štvorca $S$ so stranou $L$, ktorého ľavý dolný roh
má súradnice $[0,0]$. Navyše bez ujmy na všeobecnosti nech je $L$ mocnina dvojky.

{\bf Rekurzívnym delením} štvorca $S$ nazývame jeho rekurzívne delenie na menšie štvorce tak, že
každy štvorec rozdelíme {\bf deliacimi čiarami} na štyri rovnaké štvorce.
Deliť prestaneme, keď je strana štvorca $\leq 1$. Toto delenie predstavuje
$4$-árny strom, kde synovia každé ho štvorca sú štyri menšie štvorce. Hĺbka takéhoto stromu je
najviac $O(\lg L)$. 
Štvorcom delenia intuitívne priradíme úrovne. Štvorec $S$ má úroveň $0$, jeho synovia úroveň $1$,
atď. Deliaca čiara má úroveň $i$ vtedy, keď obsahuje hranu nejakého štvorca úrovne $i$, ale žiadneho
úrovne väčšej ako $i$.

{\bf Quadtree} definujeme podobne 
až na to, že rekurzívne delenie skončí vtedy, keď v danom štvorci je najviac jeden bod. Keďže každý
list quadtree obsahuje bod zo vstupu, alebo je súrodenec takého listu, tak quadtree má maximálne
$O(n)$ listov a teda dokopy najviac $O(n \lg L)$ štvorcov.

\smallskip

Teraz popíšeme posunuté delenie. Nech $a, b$ sú celé čísla a platí $0 \leq a, b < L$.
$(a,b)$-posunutie rekurzívneho delenia definujeme tak, že $x$-, $y-$ súradnice každej deliacej čiary
zvýšime o $a$ resp. $b$ a následne spočítame ich zvyšok po delení číslom $L$ (vstupnými bodmi
nehýbeme). Takisto posunieme aj okrajové čiary štvorca (začnú tvoriť deliace čiary). Pôvodný štvorec
pokladáme za zacyklený, teda okrajové oblasti pri posunutom delení tvoria súvislú oblasť ako na
obrázku.

TODO obrázok

Z posunutého rekurzívneho delenia vieme dodefinovať quadtree s posunom tak, že nebudeme deliť
štvorce, ktoré obsahujú najviac jeden bod.

\section{Portály a $(m,r)$-ľahké cesty}

Nás algoritmus dovolí TSP-cestám pretínať čiary delenia iba v niekoľkých
predpísaných bodoch, tzv. {\bf portáloch}. Toto je na prvý pohľad trochu kontraintuitívne.
My ale dovolíme cestujúcim cestovať medzi bodmi po ľubovoľnej čiare, teda nie nutne najkratšej
ceste medzi dvoma bodmi (viď. obrázok nižšie). Stále ale zachovávame disjuktnosť ciest, t.j. keď
jeden cestujúci ide z vrchola $x$ do vrcholu $y$, tak druhý nemôže ísť z $x$ do $y$ ani z $y$ do
$x$ (nech ide ľubovoľne zakrivenou cestou). 

\begin{definicia}
Nech $m$ je párne kladné celé číslo. $m$-regulárna množina portálov pre posunuté rekurzívne
delenie je množina bodov taká, že každá deliacia čiara úrovne $i$ obsahuje portály vo
vzdialenostiach $\frac{L}{m2^i}$. 
\end{definicia}

TODO obrázok

\begin{definicia}
TSP-cesta sa nazýva $(m,r)$-ľahká ak pretína čiary rekurzívneho delenia iba v $m$-regulárnej
množine portálov a navyše každú hranu štvorca pretína najviac $r$-krát.
\end{definicia}

TODO theorem poriadne

Teraz sformuluje hlavnú vetu, ktorá dokazuje koreknosť nášho algoritmu.

\begin{veta}
Nech $c > 0$ je ľubovoľná konštanta. Nech sú všetky body vo vstupe vzdialené aspoň $8$ a nech všetky
body ležia vo vnútri štvorca so stranou $L$. Nech $0 \leq a, b < L$ sú vybrané náhodne. Potom s
pravdepodobnosťou aspoň $1/2$ existujú dve disjuktné $(m,r)$-ľahké TSP-cesty, ktorých dĺžka je maximálne $(1 +
1/c)$-násobok optimálnej dĺžky, pričom $m = O(c \lg L)$, $r = O(c)$.
\end{veta}

Dôkaz tejto vety uvedieme neskôr. 
Najprv sa pozrime na hľadanie najkratších $(m, r)$-ľahkých ciest.

\section{Popis algoritmu}

TODO perturbacia

V nasledujúcom kroku zvolíme hodnoty $a, b$ -- posuny quad-tree. Môžeme ich zvoliť náhodne
a uspokojiť sa s tým, že máme iba pravdepodnostný algoritmus, alebo môžeme postupne vyskúšať všetky
hodnoty za cenu vyššej časovej zložitosti o faktor $O(n^2)$. Pre zvyšok tejto kapitoly budeme
predpokladať, že $a, b$ volíme náhodne. Teraz môžeme skonštruovať posunutý quad-tree. 
Keďže po predchádzajúcom kroku máme $L = O(n)$ a hĺbka quad-tree je teda najviac $O(\lg n)$, potom
počet štvorcov v quad-tree je $O(n \lg n)$ (lebo máme maximálne $n$ listov). Tento quadtree vieme
pomerne jednoducho skonštruovať v čase $O(n \lg n)$.

Teraz ideme nájsť v skonštruovanom posunutom quad-tree nájsť najlacnejšie $(m,r)$-ľahké disjuktné
TSP cesty. Využijeme techniku dynamického programovania.

Zoberme si štvorec $S$ z quad-tree a optimálne $(m,r)$-ľahké TSP cesty. Prvá z nich pretína hranicu
štvorca $S$ postupne v bodoch $a_1, a_2, \dots, a_{2p}$, kde $2p \leq 4r$ a druhá v bodoch $b_1, b_2,
\dots, b_{2q}$, kde $2q \leq 4r$. 

Časti TSP ciest vo vnútri $S$ je postupnosť ciest, ktoré majú konce v bodoch $a_{2i - 1}, a_{2i}$,
resp. $b_{2j - 1}, b_{2j}$, pre $i = 1, 2, \dots, p$, resp. $j = 1, 2, \dots q$.
Tieto cesty navyše prechádzajú všetkými bodmi vo vnútri $S$ a ich zjednotenie je $(m,r)$-ľahké.
Navyše sú tieto cesty disjuktné, t.j. neexistujú dva vrcholy $v_i$, $v_j$ vo vnútri $S$ také, že 
v obidvoch postupnostiach sú $v_i$ a $v_j$ spojené.
Ešte si všimnime vrcholy, ktoré nasledujú na cestách po jednotlivých prienikoch (keď pokračujeme po
ceste od prieniku smerom dovnútra štvorca).
Postupne ich označme pre prvú cestu ako $v^a_1, v^a_2, \dots, v^a_{2p}$ a pre druhú cestu ako
$v^b_1, v^b_2, \dots, v^b_{2q}$. Tieto vrcholy nemusia byť nutne vrcholy vo vnútri $S$, keďže časť
cesty môže prechádzať cez štvorec $S$, ale nemusí prechádzať cez žiadny vrchol.

Keďže máme optimálnu $(m,r)$-ľahkú cestu, tak aj postupnosť ciest uvedená vyššie je optimálna, t.j.
najlacnejšia taká, že jednotlivé cesty majú konce v zadaných bodoch $a_1, a_2, \dots, a_{2p}$, resp. $b_1, b_2,
\dots, b_{2q}$, najbližšie vrcholy ku koncom sú $v^a_1, v^a_2, \dots, v^a_{2p}$, resp.
$v^b_1, v^b_2, \dots, v^b_{2q}$ a tieto cesty prechádzajú všetkými bodmi vo vnútri $S$ a zároveň sú
disjuktné.

Teraz môžeme definovať vhodný podproblém pre dynamické programovanie. Jeho vstupmi budú:
\begin{itemize}
\item Štvorec $S$ z posunutého quad-tree.
\item Postupnosti portálov, ktoré majú cesty pretínať: $a_1, a_2, \dots, a_{2p}$, $b_1, b_2, \dots,
b_{2q}$.
\item Postupnosti vrcholov, do ktorých pôjdu cesty za portálmi: $v^a_1, v^a_2, \dots, v^a_{2p}$,.
$v^b_1, v^b_2, \dots, v^b_{2q}$.
\end{itemize}

Jeho výstupom je postupnosť ciest definovaná vyššie.

Predtým než ukážeme ako tento podproblém riešiť spočítame počet rôznych podproblémov.
Ako sme spomínali máme $O(n \lg n)$ štvorcov. Rôznych postupnosti portálov bude $O(m^{O(r)})$.
Rôznych postupnosti vrcholov bude $O(n^{O(r)})$. Keďže $r = O(c)$, tak stále
máme PTAS. Neskôr ukážeme ako zmenšiť člen $O(n^{O(r)})$ na člen $O(n)$.

Podproblémy vieme riešiť nasledovne. Pokiaľ obsahuje štvorec iba jeden vrchol vieme v čase $O(r)$. vyskúšať všetky
možné priradenia. Zobereme si teraz štvorec $S$, ktorý má synov $S_1, S_2, S_3, S_4$. Pre jeho synov
už máme vyriešené všetky podproblémy. Chceme teraz nájsť najlacnejšie $(m, r)$-ľahké cesty pre
štvorec $S$. Preskúšame všetky možnosti akoby cesty mohli prechádzať hranami štvorcov $S_1, S_2,
S_3, S_4$. To obnáša vybrať poradie prechodu portálmi a vrcholy, ktorými cesta bude prechádzať po
prechode portálom. Ešte potrebujeme skontrolovať disjukntosť ciest. Medzi vrcholmi vrámci štvorcov
$S_1, S_2, S_3, S_3$ máme disjuknosť zaručenú. Treba ešte zaručiť aj disjuktnosť ak cesta prechádza
medzi vrcholmi z rôznych štvorcov. To vieme zaručiť pomocou toho, že sa pozrieme aké vrcholy
nasledujú za portálmi a nepovolíme tie možnosti, v ktorých sú spojené rovnaké dvojice vrcholov v
oboch TSP cestách. Časová zložitosť tohoto kroku je najviac $O(n^{O(r)} m^{O(r)})$.

Celkový čas tohoto algoritmu je $O(n^{O(r)} m^{O(r)})$, čo je $O(n^{O(c)})$.

\section{Dôkaz hlavnej vety}


